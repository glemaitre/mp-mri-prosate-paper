%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% A template for Wiley article submissions.
% Developed by Overleaf.
%
% Please note that whilst this template provides a
% preview of the typeset manuscript for submission, it
% will not necessarily be the final publication layout.
%
% Usage notes:
% The "blind" option will make anonymous all author, affiliation, correspondence and funding information.
% Use "num-refs" option for numerical citation and references style.
% Use "alpha-refs" option for author-year citation and references style.

\documentclass[a4paper,num-refs]{wiley-article}
% \documentclass[blind,alpha-refs]{wiley-article}

% Add additional packages here if required
\input{file_system/package.tex}

% Update article type if known
\papertype{Original Article}
% Include section in journal if known, otherwise delete
\paperfield{Journal Section}

\title{Computer-aided detection and diagnosis using Multi-modal MRI for prostate cancer detection}

% List abbreviations here, if any. Please note that it is preferred that abbreviations be defined at the first instance they appear in the text, rather than creating an abbreviations list.
% \abbrevs{ABC, a black cat; DEF, doesn't ever fret; GHI, goes home immediately.}

% Include full author names and degrees, when required by the journal.
% Use the \authfn to add symbols for additional footnotes and present addresses, if any. Usually start with 1 for notes about author contributions; then continuing with 2 etc if any author has a different present address.
% \author[1\authfn{1}]{Author One PhD}
% \author[2\authfn{1}]{Author A.~Two MD}
% \author[2\authfn{2}]{Author Three PhD}
% \author[2]{Author B.~Four}
\author[1\authfn{1}]{G.~Lemaitre PhD}
\author[2\authfn{1}]{F.~Meriaudeau PhD}
\author[2\authfn{1}]{A.~Meyer-Bease PhD}
\author[2\authfn{1}]{R.~Marti PhD}
\author[2\authfn{1}]{K.~Pinker MD}
\author[2\authfn{1}]{P.~Baltzer MD}
\author[2\authfn{1}]{P.~Andrzejewski MD}
\author[1\authfn{1}]{J.~Massich PhD}

\contrib[\authfn{1}]{Equally contributing authors.}

% Include full affiliation details for all authors
\affil[1]{Department, Institution, City, State or Province, Postal Code, Country}
\affil[2]{Department, Institution, City, State or Province, Postal Code, Country}

\corraddress{Author One PhD, Department, Institution, City, State or Province, Postal Code, Country}
\corremail{correspondingauthor@email.com}

\presentadd[\authfn{2}]{Department, Institution, City, State or Province, Postal Code, Country}

\fundinginfo{Funder One, Funder One Department, Grant/Award Number: 123456, 123457 and 123458; Funder Two, Funder Two Department, Grant/Award Number: 123459}

% Include the name of the author that should appear in the running header
\runningauthor{Author One et al.}

\input{file_system/acronym_definition.tex}

\begin{document}

\maketitle


\begin{abstract}
    Study the advantages of using multi-modal imagery in computer-aided
    detection and diagnosis systems for prostate cancer with special attention to
    pre-processing and data-balancing stages of a CaD.
%
    A multi modal MR volumes including T2W-MRI, DCE-MRI, DW-MRI and MRSI with
    accompanying ground-truth were acquired from 17 patients. The proposed CaD
    system to conduct this study consists of pre-processing, segmentation, feature
    detection, data balancing, feature extraction and classification;
    and all results are cross-validated using leave one patient out strategy.
%
    The usage of multi-modal information to the CaD system increases the area
    under the curve from $0.666\pm0.15$ up to $0.836\pm0.083$, showing a better
    and more stable results.
%
    The study using the proposed framework shows that T2W-MRI is necessary to
    obtain satisfactory results however better results are obtained when combined
    with other modalities.
    % More-over the study also shows that the reliability of any modality is
    % strongly linked to the pre-processing and balancing of the data.

% Please include a maximum of seven keywords
\keywords{Computer-aided detection, prostate cancer, multi-parametric MRI, feature crafting}
\end{abstract}


\section{Introduction}

\Ac{cap} is the second most frequently diagnosed cancer in men, accounting for
899,000 cases and leading to 258,100 deaths per
year~\citep{ferlay2010estimates}. Early detection, diagnosis and accurate risk
assessment play a major role in patient treatment. In this regard,
\citeauthor{Hambrock2013}\,\cite{Hambrock2013} explore the idea of
incorporating \ac{cad} systems to assist radiologists in their clinical
practice; showing that applying \ac{cad} to \ac{cap} detection and diagnosis
improve the clinician's performance specially for inexperienced radiologists
which when assisted by \ac{cad} system are able to obtain results equivalent to
those from a senior radiologist.

Despite recent advances, in \ac{cap}-\ac{cad} remains a young technology mainly
because it is based on \ac{mri}~\cite{Hegde2013}. The two main challenges in
\ac{cap}-\ac{cad} systems, as pointed by the \ac{pirads} Steering Committee
are: (i) improving the detection of clinically significant \ac{cap} and (ii)
increasing confidence in benign or dormant cases to avoid unnecessary invasive
medical exams~\citep{weinreb2016pi}.

% \citeauthor{lemaitre2015computer}\,\cite{lemaitre2015computer} provide an
% overview and categorization of the developed \acs{cad} systems for \ac{cap}
% detection and diagnosis based on \ac{mri} modalities. The main highlights can
% be found in \acs{tab}\,\ref{tab:survey-summary}; whereas
% \acs{fig}\,\ref{fig:wkfcad} correspond to the common \ac{cad} framework
% identified in~\cite{lemaitre2015computer}, which is detailed in
% \acs{sec}\,\ref{sec:framework}.

\citeauthor{lemaitre2015computer}\,\cite{lemaitre2015computer} provides an
overview and categorization of the developed \acs{cad} systems for \ac{cap}
detection and diagnosis based on \ac{mri} modalities. As a conclusion, the
following shortcomings have been drawn: (i) not a single study used all available
\ac{mri} modalities, (ii) little attention has been granted to data
normalization, (iii) features have usually been extracted using solely 2D
information, and (iv) the problem of data balancing has never been
investigated. We refer the reader to~\cite{lemaitre2015computer} for a detailed
review of the previous work related to \ac{mpmri} \ac{cad} for prostate cancer
detection.

Therefore, we propose a \ac{mpmri} \ac{cad} framework using all available
\ac{mri} modalities, as depicted in \acs{fig}\,\ref{fig:wkfcad}. In addition,
feature extracted will take advantage of the 3D information of the data
acquired. Our framework is also incorporating a data balancing step to reduce
the classification bias introduce during the learning phase.

% The main goal of this work is to evaluate the impact of using \ac{mpmri} in
% \ac{cap}-\ac{cad} systems and also bring some light to the following key
% aspects: (i) normalization of \ac{dce}-\ac{mri} modality, (ii) the effect of
% balancing the data, and (iii) thorough study in feature selection/extraction.

The rest of this document is structured as follows:
\acs{sec}\,\ref{sec:materials_and_methods} details each step of our \ac{mpmri}
\ac{cad} system while \acs{sec}\,\ref{sec:experiments} reports a set of
experiments to give insights about each of these steps. Finally,
\ac{sec}\,\ref{sec:conclusion} concludes this work and give avenues for future
research.

% % survey's summary
% \begin{figure}
% \begin{itemize}
% \item summary:
%   \begin{itemize}
%     \item 56 studies
%     \item num of MRI modalities: 1 - 33\%, 2 - 31\%, 3 - 33\%, 4 - 1\%
%     \item Scanner type: 3T - 60\%, 1.5T - 40\%
%     \item studied zones: PZ - 45\%, PZ+CG 55\%
%     \item cad type: cade-cadx 70\%, cadx 30\%
%   \end{itemize}
% \item positive:
%   \begin{itemize}
%     \item 3 modalities better than 2
%     \item Texture and edge features are predominant
%     \item Features selection/extraction tends to improve performance
%     \item Pre-eminence of SVM and ensemble classifier (i.e., AdaBoost, RF, etc.)
%   \end{itemize}
% \item negative:
%   \begin{itemize}
%     \item no publicly available mp-mri dataset
%     \item only 1 study used 4 mri modalities
%     \item limited work on data normalization
%     \item a lot of features are extracted in 2d
%     \item limited work regarding selection/extraction
%     \item no work regarding data balancing
%     \item no source code available of any cad
%   \end{itemize}
% \end{itemize}
% \caption{Survey's summary}
% \label{tab:survey-summary}
% \end{figure}

\section{Materials and Methods} \label{sec:materials_and_methods}


% All experiments are conducted on a subset of public \ac{mpmri} prostate dataset
% available in~\citep{lemaitre2016dce}. The subset used in this work corresponds
% to the 17 \ac{cap} cases proven positive by biopsy. The images were acquired
% with a \SI{3}{\tesla} whole body \ac{mri} scanner (Siemens Magnetom Trio TIM,
% Erlangen, Germany) using sequences to obtain \ac{t2w}-\ac{mri},
% \ac{dce}-\ac{mri} and \ac{dw}-\ac{mri}. This last one is used to compute the
% \ac{adc} maps. All cases have complementary \ac{mrsi} and \ac{gt} data.
% %
% For each case the \ac{gt} is composed by the following volume-delinations
% provided by experienced radiologits: the prostate on \ac{t2w}, \ac{adc} and for
% a single \ac{dce}-\ac{mri} time series; the prostate's \ac{cg} on \ac{t2w}; plus
% all the lesion delineations, also on \ac{t2w}. A total of 5 volumes per case.


% \subsection{CaP framework} \label{sec:framework}

% \Acl{fig}~\ref{fig:wkfcad} illustrates the common \ac{cad}-\ac{cap} workflow
% resulting from the State-of-the-Art~\cite{lemaitre2015computer}, which
% consists of three distinctive processes: (i) image regularization, (ii)
% \ac{cade} and (iii) \ac{cadx}. Image regularisation focuses on formatting the data
% while \ac{cade} and \ac{cadx} allow to detect possible lesions and distinguish
% malignant from non-malignant tumors, respectively.

% Three types of pre-processing are applied to \ac{mri} images: (i) noise filtering,
% (ii) bias correction, and (iii) standardization/normalization; whereas
% \ac{mrsi} data is processed to correct the phase, baseline and frequency
% as in \citeauthor{Chen2002}\,\cite{Chen2002}.
% %
% This study does not cover automatic prostate segmentation, therefore manual
% delineations from the \ac{gt} drive the registration where needed.
% The registration of the data is done as follows: (i) \ac{dce}-\ac{mri} volumes
% are rigidly registered within themselves, to remove any patient motion during
% the acquisition; (ii) non-rigid registration is performed between the
% \ac{t2w}-\ac{mri} and the rest of modalities.
% %
% In terms of \ac{cade}, for this study all the data within the prostate is
% considerate a potential lesion.
% %
% For feature detection, the complete set of features reported in the 56 studies
% covered by \cite{lemaitre2015computer} has been implemented.
% \Ac{tab}\,\ref{tab:feat} summarizes such features indicating its reported presence.
% %
% Data balancing stage is added to ensure proper learning in a scenario where the
% number of negative samples is far greater than the positive, as this one, where
% the voxels with labeled as cancer far less than the healthy.
% %
% \ac{rf} is used in feature selection and classification steps. This choice is
% motivated by the fact that
% (i) comparison of different classifiers is out of the
% scope of this work;
% (ii) \ac{rf} is a suited classifier for the task in
% hand~\cite{lemaitre2015computer};
% and (iii) the capability to interpret the feature selection when performed using \ac{rf}.

% \subparagraph{Feature selection}
% \emph{Several feature extraction strategies are studied.}
% \subparagraph{classifier choice}
% \emph{
%   There's no interest in this work in comparing one classifier against others,
%   we just went for \ac{rf} since based of the state-of-the-art it works good and
%   bring us some insights regarding the feature selection etc..
%   \Ac{rf} is used as classifier, so that we can take advantage of feature
%   selection combination etc... we also use adaboost and gradient boosting to
%   create meta classifiers.
% %
%   Among those, \ac{rf} showed its reliability to lead to high classification performance.
%   That is why, \ac{rf} has been chosen as our base classifier --- allowing for feature selection as well --- to perform classification of individual modality as well as the combination of modalities.
% }

% \subparagraph{Other considerations:}
% (i) All the experiments are carried out using \ac{lopo}.
% (ii) The implementation of the registration (C++), normalization (Python), and
% classification pipeline (Python) are publicly available on
% GitHub\footnote{\url{https://github.com/I2Cvb/lemaitre-2016-nov/tree/master}}~\citep{lemaitre2016github}.

% \begin{table*}
%   \centering
%   \caption{Overview of the feature detection methods used in \ac{cad} systems.}\label{tab:feat}
%   \footnotesize
%   \begin{threeparttable}
%     \renewcommand{\arraystretch}{.7}
%     \begin{tabular}{p{.5\linewidth} p{.4\linewidth}}
%       \hline \\ [-1.5ex]
%       \textbf{Feature detection methods} & \textbf{Number of works using this feature} \\ \\ [-1.5ex]
%       \hline \\ [-1.5ex]
%       \textbf{\ac{mri} image:} & \\ \\ [-1.5ex]
%       \quad \textit{Voxel-wise detection} &  \\ \\ [-1.5ex]
%       \quad \quad Intensity-based & 16 \\ %0.285714285714 \\ %16/56
%       \quad \quad Edge-based & \\
%       \quad \quad \quad Prewitt operator & 4 \\
%       \quad \quad \quad Sobel operator & 9 \\
%       \quad \quad \quad Kirsch operator & 9 \\
%       \quad \quad \quad Gabor filtering & 3 \\
%       \quad \quad Texture-based & \\
%       \quad \quad \quad Haralick features & 11 \\
%       \quad \quad \quad Fractal analysis & 2 \\
%       \quad \quad \quad \Ac{dct} & 1 \\
%       \quad \quad \quad Wavelet-based features & 1 \\
%       \quad \quad \quad Gaussian filter bank & 1 \\
%       \quad \quad Position-based &  4 \\ \\ [-1.5ex]
%       \quad \textit{Region-wise detection} &  \\ \\ [-1.5ex]
%       \quad \quad Statistical-based & \\
%       \quad \quad \quad Percentiles & 10 \\
%       \quad \quad \quad Statistical-moments & 16 \\
%       \quad \quad Histogram-based & \\
%       \quad \quad \quad \acs{pdf} & 1 \\
%       \quad \quad \quad \acs{hog} & 1 \\
%       \quad \quad \quad Shape context & 1 \\
%       \quad \quad \quad \acs{lbp} & 1 \\
%       \quad \quad Anatomical-based & 3 \\
%       \textbf{\ac{dce} signal:} & \\ \\ [-1.5ex]
%       \quad Whole spectra approach & 2 \\
%       \quad Semi-quantitative approach & 5 \\
%       \quad Quantitative approach &  \\
%       \quad \quad Toft model & 7 \\
%       \quad \quad Brix model & 6 \\
%       \quad \quad Weibull function & 2 \\
%       \quad \quad PUM & 2 \\
%       \\ [-1.5ex]
%       \textbf{\ac{mrsi} signal:} & \\ \\ [-1.5ex]
%       \quad Whole spectra approach & 10 \\
%       \quad Quantification approach & 1 \\
%       \quad Wavelet-based approach & 1 \\
%       \hline
%     \end{tabular}
%     % \begin{tablenotes}
%     % \end{tablenotes}
%   \end{threeparttable}
% \end{table*}


% Our \ac{mpmri} \ac{cad} system consists of seven different steps: pre-processing, segmentation, registration, feature detection, balancing, feature selection/extraction, and finally classification.

% \paragraph{Pre-processing}
% Three types of pre-processing are used for \ac{mri} images: (i) noise filtering, (ii) bias correction, and (iii) standardization/normalization.

% Additionally, the \ac{mrsi} modality requires a specific pre-processing based on signal processing rather than image processing.
% Therefore, the \ac{mrsi} modality has been pre-processed to correct the phase, baseline, and frequency.
% Additionally, each \ac{mrsi} spectrum is normalized using the L$_2$ norm, which has been shown to be the most efficient normalization method in \ac{mrsi} as discussed in \acs{sec}\,\ref{subsec:chp3img-reg:prepro}.
% \paragraph{segmentation}
% For this study, no segmentation method has been developed and the manual segmentation given by our radiologist has been used.
% \paragraph{registration}
% \paragraph{balancing}
% \paragraph{feature detection}

% To approach the task of automatic detection of \ac{cap} using machine learning, one has to extract a variety of feature specific to the \ac{mri} modality as presented in \acs*{sec}\,\ref{subsec:chp3:img-clas:CADX-fea-dec}.

% \subparagraph{\ac{t2w}-\ac{mri} and \ac{adc} map features}
% \Acl{tab}~\ref{tab:featureadct2w} summarizes the different features extracted with their corresponding parameters.
% Note that all these features are extracted at each voxel of the volume.
% \begin{table}
%   \caption{Features extracted in \acs*{t2w}-\acs*{mri} and \acs*{adc} volumes.}
%   \centering
%   \scriptsize
%   \begin{tabularx}{\textwidth}{lXc}
%     \toprule
%     \textbf{Features} & \textbf{Parameters} & \textbf{\# dimensions} \\
%     \midrule
%     Intensity &  & 1 \\
%     \acs*{dct} decomposition & window: \SI[product-units=repeat]{9x9x3}{\px} & 243 \\
%     Kirsch filter &  & 2 \\
%     Laplacian filter &  & 1 \\
%     Prewitt filter &  & 3 \\
%     Scharr filter &  & 3 \\
%     Sobel filter &  & 3 \\
%     Gabor filters & 4 frequencies $f \in [0.05, 0.25]$; 4 azimuth angles $\alpha \in [0, \pi]$; 8 elevation angles $\alpha \in [0, 2\pi]$ & 256 \\
%     Phase congruency filter & 5 orientations; 6 scales & 3 \\
%     Haralick filter & window: \SI[product-units=repeat]{9x9x3}{\px}; \# grey levels: 8; distance: \SI{1}{\px}; 13 directions & 169 \\
%     \acs*{lbp} filter & 2 radii $r=\{1, 2\}$; 2 neighborhood sizes $N = \{8, 16\}$ & 6 \\
%     \bottomrule
%   \end{tabularx}
%   \label{tab:featureadct2w}
% \end{table}

% To approach the task of automatic detection of \ac{cap} using machine learning, one has to extract a variety of feature specific to the \ac{mri} modality as presented in \acs*{sec}\,\ref{subsec:chp3:img-clas:CADX-fea-dec}.

% \paragraph{Feature extraction}
% Feature selection and extraction are used in the experiment: (i) signal-based data --- i.e., \ac{mrsi} and \ac{dce}-\ac{mri} --- are decomposed using feature extraction methods while (ii) image-based features are selected through different feature selection methods.
% These methods have been presented in \acs{sec}\,\ref{subsec:chp3:img-clas:CADX-fea-ext}.

% Among those, \ac{pca}, sparse-\ac{pca}, and \ac{ica} are used to decompose signal-based data.
% \paragraph{classification}
% Variety of classifiers have been explained in \acs{sec}\,\ref{subsec:chp3:img-clas:CADX-clas}.

% Among those, \ac{rf} showed its reliability to lead to high classification performance.
% That is why, \ac{rf} has been chosen as our base classifier --- allowing for feature selection as well --- to perform classification of individual modality as well as the combination of modalities.

% % \begin{figure}
% %   \centering
% %   \includegraphics[width=0.5\linewidth]{content/figures/stacking_gb.png}
% %   \caption[The principle of stacking.]{The principle of stacking. First,
% %     training samples (red) are used to train each individual \ac{rf}.
% %     Subsequently, a validation set (green) is provided to each \ac{rf} which
% %     outputs a set of probabilities used for the classification of the
% %     meta-classifier. Finally, a test set is used to asses the classification
% %     performance to whole stack.}
% %   \label{fig:stacking}
% % \end{figure}

% Additionally, we use stacking to create ensemble of base learners using a meta-classifier~\cite{wolpert1992stacked}.
% \Acl{fig}~\ref{fig:stacking} illustrate the principle of stacking.
% Stacking consists in a two-stage learning:
% (i) First, a set of training samples is used to train each individual base learner and
% (ii) subsequently, a set of validation samples is provided to each \ac{rf} which individually output a corresponding set of probability used to train a meta-classifier.
% Finally, the stack of classifiers is assessed by providing a test set which is going through the base learners and the meta-classifier.

% In the later experiments, \ac{adb} and \ac{gb} are chosen as meta-classifiers to aggregate the base learners in the stacking strategies.
% The difference between \ac{adb} and \ac{gb} lie in the fact the this
% minimization procedure.

As presented in the introduction, this section details each step of the
workflow of the proposed \ac{mpmri} \ac{cad} system (see
\acs{fig}\,\ref{fig:wkfcad}).

\begin{figure}
  \centering
  \includegraphics[width=0.7\linewidth]{./images/cad/wkfcad.pdf}
  \caption{Our proposed \ac{mpmri} \ac{cad} framework for prostate cancer
    detection.}
  \label{fig:wkfcad}
\end{figure}

\subsection{Segmentation and registration}

Our main focus in this study is related to the \ac{cadx}. We used manual
segmentation provided by our radiologists (prostate gland, cancerous regions,
and prostate regions). In addition, we applied different registration methods
to align the images: (i) the patient motion during the \ac{dce}-\ac{mri}
acquisition, (ii) the patient motion between the \ac{t2w}-\ac{mri} and the
\ac{dce}-\ac{mri} acquisitions, and (iii) the patient motion between the
\ac{t2w}-\ac{mri} and the \ac{adc} map acquisition.

\textcolor{red}{Therefore manual segmentation provided by our radiologists was
  used (prostate gland, cancerous regions, and prostate regions).  Next,
  different registration methods were used to align: (i) the patient motion
  during the \ac{dce}-\ac{mri} acquisition, (ii) the patient motion between the
  \ac{t2w}-\ac{mri} and the \ac{dce}-\ac{mri} acquisitions, and (iii) the
  patient motion between the \ac{t2w}-\ac{mri} and the \ac{adc} map
  acquisition.}

(i) The \ac{dce}-\ac{mri} acquisition being dynamic, some intra-patient motions
might occur during the acquisition. For each serie of this dynamic
acquisition, each 3D volume is registered to the first volume acquired, to
remove the residual motion. The appearance in the \ac{dce}-\ac{mri} images,
however, varies due to the presence or not of the contrast media. Therefore,
the metric chosen to be minimized is the \ac{mi} and the geometric transform
has been set to a rigid transform. The optimization is performed using a
regular step gradient descent.

\textcolor{red}{(i) Due to dynamic acquisition of \ac{dce}-\ac{mri}, some
  intra-patient motions might occur during the acquisition. To remove
  this residual motion, for each serie of a dynamic acquisition, each 3D
  volume is registered to the first volume acquired. The appearance in the
  \ac{dce}-\ac{mri} images, however, varies due to the presence or not of the
  contrast media. Therefore, the metric chosen to be minimized is the \ac{mi}
  and the geometric transform has been set to a rigid transform. The
  optimization is performed using a regular step gradient descent.}

(ii) Once the intra-patient motions corrected, a registration to correct the
alignment between the \ac{t2w}-\ac{mri} and the \ac{dce}-\ac{mri} acquisitions
is performed. For that matter, the prostate has been segmented in both
modalities --- \ac{t2w}-\ac{mri} and \ac{dce}-\ac{mri} --- to create two binary
masks. Therefore, these 3D binary masks are directly registered using the
\ac{mse} metric. Unlike the previous registration, we use a more complex
geometric transform by successively finding a rigid transformation, a coarse
elastic transformation, and a fine elastic transformation. B-splines
transformation is used as the elastic transform. These successive
transformations allow to get a good initialization for the next transformation.
The transformation is inferred by minimizing the cost function using a regular
step gradient descent.

\textcolor{red}{(ii) To correct the alignment between \ac{t2w}-\ac{mri} and the
  \ac{dce}-\ac{mri}, the prostate has been segmented in both modalities ---
  \ac{t2w}-\ac{mri} and \ac{dce}-\ac{mri} --- to create two binary masks. These
  3D binary masks are directly registered using the \ac{mse} metric. The
  registration is performed by finding a rigid transformation, a coarse elastic
  transformation, and a fine elastic transformation. B-splines transformation
  is used as the elastic transform. These successive transformations allow to
  get a good initialization for the next transformation. The transformation is
  inferred by minimizing the cost function using a regular step gradient
  descent. }

(iii) The \ac{t2w}-\ac{mri} and \ac{adc} map acquisitions are registered using
the same approach as for the registration of the \ac{t2w}-\ac{mri} and the
\ac{dce}-\ac{mri} modalities.  Additionally, the \ac{cap}, \ac{pz}, and \ac{cg}
are segmented on the \ac{t2w}-\ac{mri} and thus \ac{t2w}-\ac{mri} is used as
the reference modality.

\subsection{Feature detection}

This section highlights the features which are extracted for each modality. For
both cases, \ac{dce}-\ac{mri} and \ac{mrsi}, different models are
presented. Experiments in \acs{sec}\,\ref{exp:feat_det} are designed to select
the best strategies to adopt.
\textcolor{red}{In accordance to different modalities, two categories of
  features are extracted: (i)2D/3D image-based features
  (\acs*{t2w}-\ac{mri}/\acs*{adc}), (ii) 1D
  features(\acs*{dce}-\ac{mri}/\acs*{mrsi})}

\subsubsection{Image-based features (\acs*{t2w}-\ac{mri}/\acs*{adc})}

\begin{table}
  \caption{Features extracted in \acs*{t2w}-\acs*{mri} and \acs*{adc} volumes.}
  \centering
  \scriptsize
  \begin{tabular}{llc}
    \toprule
    \textbf{Features} & \textbf{Parameters} & \textbf{\# dimensions} \\
    \midrule
    Intensity &  & 1 \\
    \acs*{dct} decomposition & window: \SI[product-units=repeat]{9x9x3}{\px} & 243 \\
    Kirsch filter &  & 2 \\
    Laplacian filter &  & 1 \\
    Prewitt filter &  & 3 \\
    Scharr filter &  & 3 \\
    Sobel filter &  & 3 \\
    Gabor filters & 4 frequencies $f \in [0.05, 0.25]$; 4 azimuth angles $\alpha \in [0, \pi]$; 8 elevation angles $\alpha \in [0, 2\pi]$ & 256 \\
    Phase congruency filter & 5 orientations; 6 scales & 3 \\
    Haralick filter & window: \SI[product-units=repeat]{9x9x3}{\px}; \# grey levels: 8; distance: \SI{1}{\px}; 13 directions & 169 \\
    \acs*{lbp} filter & 2 radii $r=\{1, 2\}$; 2 neighborhood sizes $N = \{8, 16\}$ & 6 \\
    \bottomrule
  \end{tabular}
  \label{tab:featureadct2w}
\end{table}

A set of common features reported in~\cite{lemaitre2015computer} are
computed. \Acl{tab}~\ref{tab:featureadct2w} summarizes the different features
extracted with their corresponding parameters. Note that all these features are
extracted at each voxel of the volume. The voxel intensities are the most
common features encoding tumor information. However, those intensities vary
between patients. Therefore, \ac{t2w}-\ac{mri} modality is normalized using a
Rician \emph{apriori} as presented
in~\cite{lemaitre2016normalization}. \Ac{adc} coefficient is standardized as
in~\cite{Nyul1999}. The following set of filters characterizing edges are
extracted: (i) Kirsch, (ii) Laplacian, (iii) Prewitt, (iv) Scharr, (v) Sobel,
and (vi) Gabor. Apart of the Kirsh filter, other filters can be extended into
3D filter. 3D Gabor filters are not commonly used and we reused the formulation
presented in~\cite{wang2005face}. Additionally, features based on phase
congruency as proposed by \citeauthor{kovesi1999image} are
computed~\cite{kovesi1999image}. Therefore, from a set of Log-Gabor filter
bank, the orientation image, the local weighted mean phase angle, and the phase
angle are estimated at each voxel. To characterize the local texture, both
second-order \ac{glcm}-based features~\cite{Haralick1973} and rotation
invariant and uniform \ac{lbp}~\cite{ojala2002multiresolution} are
extracted. To encode 3D information, the 13 first Haralick features are
computed for the 13 possible directions. For the same reason, the \ac{lbp}
codes are computed for the three-orthogonal-planes of each \ac{mri} volume.

\subsubsection{\acs*{dce}-\acs*{mri} features}

Properties of \ac{dce}-\ac{mri} are usually extracted using quantitative or
semi-quantitative approaches~\cite{lemaitre2015computer}.

\emph{Quantitative approaches} uses pharmacokinetic modeling based on a
bicompartment model, namely Brix~\cite{brix1991pharmacokinetic} and
Tofts~\cite{tofts1995quantitative} models. The parameters of the Brix model
are inferred by assuming a linear relationship between the media concentration
and the \ac{mri} signal intensity. However, this assumption has been shown to
lead to inaccurate estimations of the pharmacokinetic
parameters~\cite{heilmann2006determination}. In contrast, the Tofts model
requires the conversion of \ac{mri} signal intensity to concentration, which
becomes a non-linear relationship using a specific equation of \ac{mri}
sequences (e.g., FLASH sequence). Tofts modeling, however, is highly
complex~\cite{gliozzi2011phenomenological}. Achieving the conversion using the
non-linear approach requires the acquisition of a T$_1$ map which is not always
possible during clinical examination. Additionally, computing the parameters
require the \ac{aif} which is challenging to measure and influence the estimation.

\emph{Semi-quantitative} approaches are mathematical rather than
pharmacokinetic because no pharmacokinetic assumptions regarding the
relationship between the \ac{mri} signal and the contrast agent are
made~\cite{huisman2001accurate,gliozzi2011phenomenological}. These methods are
advantageous because they do not require any knowledge of the \ac{mri} sequence
or any conversion from signal intensity to concentration. However, they present
some limitations: the heuristic approach proposed
by~\citeauthor{huisman2001accurate} requires an initial estimate of the
standard deviation of the signal noise and some manual
tuning~\cite{huisman2001accurate}.

Nevertheless, all of the presented methods suffer from the following two major
drawbacks: (i) inter-patient variability and (ii) loss of information. The
inter-patient variability is mainly due to the acquisition process and
consequently leads to generalization issues in applying a machine learning
algorithm. All previous methods extract few discriminative parameters to
describe the \ac{dce}-\ac{mri} signal which might lead to a loss of
information. Therefore, in addition of extracting all presented models, we
propose a method to normalize \ac{dce}-\ac{mri} to reduce inter-patient
variations. As a consequence, no parametric models is required and the entire
\ac{dce}-\ac{mri} normalized signal can be used as feature. Refer to
\acs{sec}\,\ref{exp:dce_sel} regarding the experiments related to
\ac{dce}-\ac{mri} modeling.

\begin{figure*}
  \centering
  \hspace*{\fill}
  \subfigure[]{\label{subfig:pathhist}\includegraphics[width=1\textwidth]{images/DCE-normalization/heatmaprep.pdf}} \hfill
  \hspace*{\fill}
  \\
  \hspace*{\fill}
  \subfigure[$I_0$: 117; $t_0$: 6\textsuperscript{th} serie; wider st. dev.]{\label{subfig:pat1}\includegraphics[width=.49\textwidth]{images/DCE-normalization/pat1_annotated.pdf}} \hfill
  \subfigure[$I_0$: 103; $t_0$: 4\textsuperscript{th} serie; narrower std. dev.]{\label{subfig:pat2}\includegraphics[width=.49\textwidth]{images/DCE-normalization/pat2_annotated.pdf}} \hfill
  \hspace*{\fill}
  \caption{\protect\subref{subfig:pathhist} Illustration of the heatmap
    representation: all \ac*{pdf}s of the prostate gland are concatenated
    together to build an heatmap;
    \protect\subref{subfig:pat1}-\protect\subref{subfig:pat2} Heatmap of 2
    patients revealing the three types of inter-patient variations: intensity
    shift ($\Delta_i$), time shift ($\Delta_t$), and intensity scale
    ($\alpha_i$).}
  \label{fig:heatmap}
\end{figure*}

\subparagraph{Normalization of \ac{dce}-\ac{mri}} In \ac{dce}-\ac{mri}, the
intensity \ac{pdf} of the prostate gland does not follow a unique type of
distribution such as Rician or Gaussian distribution, as shown in
Fig.\,\ref{subfig:pathhist}. Indeed, the inter-patient variations are more
complex due to the temporal acquisition. A better means of observing these
variations is to represent the intensity \ac{pdf} of the prostate gland over
time--- requiring segmentation of the prostate ---using a heatmap
representation as shown in Fig.\,\ref{subfig:pathhist}. By analyzing this
heatmap representation across patients (see Fig.\,\ref{subfig:pat2}), the
following variations are highlighted: (i) intensity offsets ($\Delta_i$) of the
\ac{pdf} peak, (ii) a time offset ($\Delta_t$) depending on the contrast agent
arrival, and (iii) a change of scale ($\alpha_i$) related to the signal
enhancement. Therefore, our normalization method should attenuate all of these
variations and be performed globally across the different time sequences rather
than for each independent sequence.

\begin{figure}
  \centering
  \includegraphics[width=0.45\linewidth]{images/DCE-normalization/estimator.pdf}
  \caption{Illustration of the estimator found using the shortest-path through
    the graph.}
  \label{fig:estimator}
\end{figure}

\subparagraph{Graph-based intensity offsets correction} Before standardizing
each sequence, the first step of the normalization process is to cancel the
intensity shift specific at each patient, which occurs due to the media
injection. As previously mentioned, the intensity \ac{pdf} does not always
follow a Rician or a Gaussian distribution over time in
\ac{dce}-\ac{mri}. Therefore, the mean of these distributions cannot be used as
a potential estimate for these offsets. Additionally, these offsets should be
characterized by a smooth transition between series over time.

Thus, this problem is solved using graph-theory: considering the intensity
\ac{pdf} over time as shown in Fig.\,\ref{subfig:pathhist}, the offsets
correspond to the boundary splitting, the heatmap into two partitions such that
they are as close as possible to the peak of the intensity \ac{pdf} (see
Fig.\,\ref{fig:estimator} for an illustration). Given the heatmap, a directed
weighted graph $\mathcal{G}=(\mathcal{V}, \mathcal{E})$ is built by taking each
bin---, i.e., the probability for a given time and pixel intensity---, of the
heatmap as a node and connecting each pair of bins by an edge. The edge weight
$w_{ij}$ between two nodes $i$ and $j$ corresponds to two pixel intensities at
positions $(x_i, y_i)$ and $(x_j, y_j)$, respectively, is defined as in
Eq.\,\eqref{eq:weight}, as follows:

\begin{equation}\small
  w_{ij} = \begin{cases}
    \alpha \exp(1 - \frac{H(i)}{\max(H)})       & \text{if } x_j = x_i + 1 \text{ and } y_j = y_i, \\
    (1 - \alpha) \exp(1 - \frac{H(i)}{\max(H)}) & \text{if } x_j = x_i \text{ and } y_j = y_i + 1, \\
    0                                           & \text{otherwise},
  \end{cases}
  \label{eq:weight}
\end{equation}

\noindent where $H$ is the heatmap, and $\alpha$ is a smoothing parameter
controlling for the partitioning.

Therefore, these offsets related to $\Delta_i$ are estimated by finding the
shortest-path to cross the graph using Dijkstra's algorithm.  The entry and
exiting nodes are set to be the bin with the maximum probability for the first
value in the \ac{dce}-\ac{mri} series and the bin corresponding to the median
value for the last value of the \ac{dce}-\ac{mri} series, respectively.  To
ensure a robust estimation of these offsets, the process of finding the
shortest-path is repeated by shifting the data and updating the heatmap as well
as the graph $\mathcal{G}$. The procedure is stopped once the offset found does
not change. In general, this process is not repeated more than 3 times.  The
parameter $\alpha$ is set to $0.9$, empirically. Figure~\ref{fig:estimator}
illustrates the final estimation of the offsets, $\Delta_i$ (i.e., red
landmark), found for each value of the \ac{dce}-\ac{mri} series.  Therefore,
each intensity offset is subtracted for each \ac{dce}-\ac{mri}.

\begin{figure*}
  \centering
  \hspace*{\fill}
  \subfigure[\acs*{rmse} computed for each patient of our dataset.]{\label{fig:rmse}\includegraphics[width=.44\textwidth]{images/DCE-normalization/rmse.pdf}} \hfill
  \subfigure[\acs*{rmse} after alignment using the curve parametric model.]{\label{fig:rmseal}\includegraphics[width=.49\textwidth]{images/DCE-normalization/rmse_aligned.pdf}}
  \hspace*{\fill}
  \caption{Illustration of the correction of the time offset and the data
    dispersion.}
  \label{fig:curveal}
\end{figure*}

\subparagraph{Time offset and data dispersion correction} The next variations
to correct are the time offset, $\Delta_t$, and the data dispersion,
$\alpha_i$. By computing the \ac{rmse} of the intensities for each value of the
\ac{dce}-\ac{mri} series, one can observe these two variations as shown in
Fig.\,\ref{fig:rmse}. Therefore, these variations are corrected by registering
the \ac{rmse} of each patient to a mean model computed using all patients and
obtaining an estimate for the parameters $\Delta_t$ and $\alpha_i$. An
illustration of the correction applied to each \ac{rmse} of the patients is
shown in Fig.\,\ref{fig:rmseal}. Once all of these parameters have been
determined, the data are shifted and scaled. The resulting normalized data can
be used into two ways: (i) each normalized signal can be used as a whole to
determine if the corresponding voxel is healthy or cancerous or (ii) the
normalized data can be fitted using a quantitative method, as presented in the
next section.

% \begin{equation}
%   T(\alpha, \tau, f(t)) = \alpha f(t - \tau) ,
%   \label{eq:model}
% \end{equation}

% \noindent where $\alpha$ and $\tau$ are the two parameters handling the time
% offset $\Delta_i$ and the global scale $\sigma_i$, respectively, $f(\cdot)$ is
% the \ac{rmse} function defined as follows:

% \begin{equation}
%   f(t) = \sqrt{ \left( \frac{\sum_{n=1}^{N} x(t)_{n}^2}{N}  \right) },
%   \label{eq:rmsd}
% \end{equation}

% \noindent where $x(t)_n$ is the shifted intensity of a sample from a specific
% \ac{dce}-\ac{mri} series value at time $t$ from a total number of $N$ samples.
% Therefore, the registration problem is equivalent to:

% \begin{equation}
%   \argmin_{\alpha, \tau} = \sum_{t=1}^{N} \left[ T\left(\alpha, \tau, f(t)\right) - \mu(t) \right]^{2} ,
%   \label{eq:cost}
% \end{equation}

% \noindent where $\mu(\cdot)$ is the mean model and, $N$ is the number of values
% in the \ac{dce}-\ac{mri} series.

\subsubsection{\ac{mrsi} features}

First, the \ac{mrsi} signal is pre-processed by correcting the
phase~\cite{Chen2002}, baseline~\cite{xi2008baseline}, and
frequency~\cite{Parfait2012}. Additionally, each \ac{mrsi} spectrum is
normalized using the L$_2$ norm, which has been shown to be the most efficient
normalization method in \ac{mrsi}~\cite{Parfait2012}.  Once the signal are
pre-processed, two strategies are commonly used to extract discriminative
features from \ac{mrsi}: (i) relative quantification based on metabolite
quantification and (ii) spectra extraction~\cite{Parfait2012}.

In \emph{relative quantification} based on metabolite quantification, citrate
and choline peaks are robustly fitted and integrated. Therefore, the relative
concentrations of citrate and choline are quantified using a Gaussian
mixture. We solve this problem with a non-linear curve fitting problem under
constraints. The constraints imposed are related to the peak location of the
citrate and choline.

The latter strategies is based on the work of~\cite{Parfait2012}. The full
\ac{mrsi} signal from \SIrange{2}{4}{\ppm} is used as features, letting the
classifier define the important \si{\ppm} bandwidth.

Refer to \acs{sec}\,\ref{exp:mrsi} which is designed to select the best
strategies.

\subsection{Data balancing}

Imbalanced dataset is a recurrent issue in classification. A dataset is
imbalanced when a class is over-represented compared to other classes. In our
application, the number of cancerous voxels is under-represented compared to
healthy voxels. In classification, imbalanced datasets are either under- or
over-sampled ahead of training, avoiding the classifiers to learn a bias toward
the over-represented class. In this section, we present the different methods
which we used to alleviate this issue. The reader is referred to
\acs{sec}\,\ref{exp:balancing} presenting the experiments investigating the
effect of balancing the dataset during the training phase.

\subsubsection{\Acl*{us1}}

A dataset can be balanced by \ac{us1} samples from the over-represented
classes.

\Ac{nm} offers three different methods to under-sample the majority
class~\cite{mani2003knn}. In \ac{nm1}, samples from the majority class are
selected such that for each sample, the average distance to the $k$ \ac{nn}
samples from the minority class is minimum. \ac{nm2} diverges from \ac{nm1} by
considering the $k$ farthest neighbours samples from the minority class. In
\ac{nm3}, a subset $M$ containing samples from the majority class is generated
by finding the $m$ \ac{nn} from each sample of the minority class. Then,
samples from the subset $M$ are selected such that for each sample, the average
distance to the $k$ \ac{nn} samples from the minority class is maximum. In our
experiment, $k$ and $m$ are fixed to 3.

\Ac{iht} select samples with a high hardness
threshold~\cite{smith2014instance}. Hardness indicates the likelihood of
mis-classification rate for each samples. The notation of instance hardness
are drawn through the decomposition of $p(h \vert t)$ using Bayes' theorem,
where $h$ represent the mapping function used to map input features to their
corresponding labels and $t$ represents the training set.
\begin{equation}
  IH_h(\langle x_{i}, y_{i}\rangle) = 1 - p(y_i \vert x_i, h).\
  \label{eq:iht}
\end{equation}
Therefore, under-sampling is performed by keeping the most probable samples ---
i.e, filtering the samples with high hardness value --- through \ac{kcv}
training sets while considering specific threshold for filtering.

\subsubsection{\Acl*{os}}

In contrast to \ac{us1} techniques, a dataset can be balanced by \ac{os} the
samples from the under-represented class.

\Ac{smote} is a method to generate new synthetic
samples~\cite{chawla2002smote}. Let define $x_i$ as a sample belonging to the
minority class. Let define $x_{nn}$ as a randomly selected sample from the
$k$-\ac{nn} of $x_i$, with $k$ set to 3. A new sample $x_j$ is generated such
that $x_j = x_i + \sigma \left( x_{nn} - x_i \right)$, where $\sigma$ is a
random number in the interval $\left[0,1\right]$. \Ac{smoteb1} over-samples the
minority class samples similarly to \ac{smote}~\cite{han2005borderline}.
However, instead of using all the minority samples, it focuses on the
borderline samples of minority class.  Borderline samples simply indicate the
samples that are closer to the other class. First, the borderline samples of
minority class are detected. A sample $x_{i}$ belongs to borderline samples if
more than half of its $k$-\ac{nn} samples belong to the majority
class. Synthetic data is then created based on \ac{smote} method for borderline
samples, by selecting. Then, $s$-\ac{nn} of the minority class are selected to
generate synthetic sample similarly to \ac{smote}. \Ac{smoteb2} performs
similarly to \ac{smoteb1}~\cite{han2005borderline}.  However, the $s$-\ac{nn}
are not computed by only considering the minority class but by considering both
classes. The same generation rules as \ac{smote} is used.

\subsection{Feature selection}

\Ac{rf} provides information regarding the importance of each feature. The
feature importance in \ac{rf} is linked with the Gini importance. In a tree
classifier, the Gini impurity criterion of the child nodes is inferior to the
parent node. For each individual feature, adding the decrease of the Gini
impurity along the tree gives information about the feature importance: the
higher, the better. Therefore, one can add the decrease of the Gini impurity
across all the trees of a forest and obtain the importance of a specific
feature for this forest. Subsequently, the $K$ most important features are
selected to perform the feature selection. Therefore, in addition to use
\ac{rf} as our base classifier, we also use it to identified important features
as reported by the experiments in \acs{sec}\,\ref{exp:selection}.

\subsection{Classification/fusion}

\ac{rf} serves as our base classifier. Indeed, \ac{rf} is used with 2 different
strategies: (i) all features are aggregated together and (ii) for each
modality, a \ac{rf} classifier is trained and output their prediction into
another classifier which serve as meta-classifier. We refer to this strategy as
\emph{stacking}. It allows to understand the benefit of integrating a specific
modality in the learning. Refer to \acs{sec}\,\ref{exp:classification} which
gives insights about those 2 strategies.

\section{Experiment and results}\label{sec:experiments}

\subsection{Data}\label{sec:data}

The \ac{mpmri} data are acquired from a cohort of patients with higher-than-normal level of \ac{psa}.
The acquisition is performed using a \SI{3}{\tesla} whole body \ac{mri} scanner (Siemens Magnetom Trio TIM, Erlangen, Germany) using sequences to obtain \ac{t2w}-\ac{mri}, \ac{dce}-\ac{mri}, \ac{dw}-\ac{mri}, and \ac{mrsi}.
Aside of the \ac{mri} examination, these patients also have undergone a guided-biopsy.
The dataset is composed of a total of 19 patients of which 17 patients have biopsy proven \ac{cap} and 2 patients are ``healthy'' with negative biopsies.
From those 17, 12 patients have a \ac{cap} in the \ac{pz}, 3 patients have \ac{cap} in the \ac{cg}, 2 patients have invasive \ac{cap} in both \ac{pz} and \ac{cg}.
An experienced radiologist has segmented the prostate organ --- on \ac{t2w}-\ac{mri}, \ac{dce}-\ac{mri}, and \ac{adc}-\ac{mri} --- as well as the prostate zones --- i.e., \ac{pz} and \ac{cg} ---, and \ac{cap} on the \ac{t2w}-\ac{mri}.

A \SI{3}{\mm} slice fat-suppressed \ac{t2w} fast spin-echo sequence (\ac{tr}: \SI{3400}{\ms}, \ac{te}: \SI{85}{\ms}, \ac{etl}:13) is used to acquire images in sagittal and oblique coronal planes, the latter planes being orientated perpendicular or parallel to the prostate \ac{pz} â€“ rectal wall axis.
Three-dimensional \ac{t2w} fast spin-echo (\ac{tr}: \SI{3600}{\ms}, \ac{te}: \SI{143}{\ms}, \ac{etl}: 109, slice thickness: \SI{1.25}{\mm}) images are then acquired in an oblique axial plane.
The nominal matrix and \ac{fov} of the 3D \ac{t2w} fast spin-echo images are \SI[product-units=repeat]{320x256}{\milli\metre\squared} and \SI[product-units=repeat]{280x240}{\milli\metre\squared}, respectively, thereby affording sub-millimetric pixel resolution within the imaging plane.

\ac{dce}-\ac{mri} is performed using a fat suppressed 3D T$_1$ VIBE sequence (\ac{tr}: \SI{3.25}{\ms},\ac{te}: \SI{1.12}{\ms}, Flip angle:\SI{10}{\degree}; Matrix: $256 \times 192$; \ac{fov}: $280 \times 210$ (with \SI{75}{\percent} rectangular \ac{fov}); slab of 16 partitions of \SI{3.5}{\mm} thickness; temporal resolution: \SI{6}{\s}/slab over approximately \SI{5}{\minute}).
A power injector (Medrad, Indianola, USA) is used to provide a bolus injection of Gd-DTPA (Dotarem, Guerbet, Roissy, France) at a dose of \SI{0.2}{\ml} Gd-DTPA/kg of body weight.

\ac{dw}-\ac{mri} images have been acquired using the single-shot spin-echo echo-planar imaging (EPI) technique.
As proposed by \citeauthor{stejskal1965spin}~\cite{stejskal1965spin}, the diffusion-encoding gradients have been applied using a pulsed gradient spin-echo technique resulting in diffusion images acquired at 2 b-values --- i.e., \SI{100}{\second\per\milli\meter\squared} and \SI{800}{\second\per\milli\meter\squared} --- and in the 3 orthogonal directions.
Sequential sampling of the k-space has been used with a \ac{te} of \SI{101}{\ms}, a \ac{tr} of \SI{4200}{\ms}, and a bandwidth of \SI{1180}{\hertz\per\px}.
Other parameters included a \ac{fov} of \SI{240}{\milli\metre}, an acquisition matrix size of $128 \times 128$ and a slice thickness of \SI{3.5}{\milli\metre}.
The \ac{adc} map has been directly generated by the Siemens workstation from the raw data on a pixel-by-pixel basis.

\ac{mrsi} is performed using a water and lipid suppressed double-spin-echo point-resolved spectroscopic (PRESS) sequence optimized for quantification detection of choline and citrate metabolites.
Water and lipid have been suppressed using a dual-band spectral spatial pulse technique.
In order to eliminate signals from adjacent tissues, especially periprostatic lipids and the rectal wall up to 8 outer voxel saturation pulses have been used.
Datasets have been acquired as $16 \times 12 \times 16$ --- interpolated to $16 \times 16 \times 16$ phase-encoded spectral arrays, a \ac{te} of \SI{140}{\ms}, a \ac{tr} of \SI{720}{\ms} and \SI{13}{\minute} of acquisition time.
A spectral bandwidth of \SI{1250}{\hertz} has been used with 512 data points.
A combination of an elliptic weighted averaged k-space acquisition scheme 3D filtering of the signal in k-space have been used, the latter in order to reduce intervoxel signal combination.
Shimming has been carried out using the Siemenbens 3D Mapshim routine on a voxel adapted to the volume of the entire prostate gland.
Additional unsuppressed water acquisitions at \ac{te} of \SI{30}{\ms}, \SI{80}{\ms}, and \SI{140}{\ms} of \SI{1.5}{\minute} have also been performed in order to allow quantification with respect to prostate water.
Systematic verification of the global shim --- i.e., over the complete 3D PRESS-selected volume --- revealed line widths at half-height of the water peak of the order of \SIrange{20}{30}{\hertz}, routinely.
The line widths for individual voxels are of the order of \SIrange{8}{12}{\hertz}.
The total examination time, including the time spent positioning the patient,
is approximately 45 minutes.

\subsection{Cross-validation and classifier}

\subsection{Baseline classification for the each modality}\label{exp:feat_det}

\begin{figure}
  \hspace*{\fill}
  \subfigure[\ac{roc} \ac{auc} for the different quantification used for \ac{dce}-\ac{mri}.] {
    \label{fig:dce_roc}
    \includegraphics[width=.45\textwidth]
    {images/DCE-normalization/dce_models_roc.pdf}
  }
  \hfill
  % \subfigure[]{
  %   \label{fig:dce_wilcoxon}
  %   \includegraphics[width=.45\textwidth]
  %   {images/DCE-normalization/dce_models_wilcoxon.pdf}
  % }
  % \hspace*{\fill}
  \subfigure[\ac{roc} \ac{auc} for the different quantification used for \ac{mrsi}.] {
    \label{fig:mrsi_roc}
    \includegraphics[width=.45\textwidth]
    {images/mrsi_all.pdf}
  }
  \hspace*{\fill}
  \\
  \hspace*{\fill}
  \subfigure[Summary of the \ac{roc} \ac{auc} for all \ac{mri} modalities.]{
    \label{fig:single_modality_roc}
    \includegraphics[width=.45\textwidth]
    {images/all.pdf}
  }
  \hspace*{\fill}
  \caption[]{Summary of the baseline classification for each individual
    \ac{mri} modality.}
  \label{fig:dce_results}
\end{figure}

\subsubsection{Feature detection - \Ac{dce}-\ac{mri}}\label{exp:dce_sel}

\subsubsection{Feature detection - \Ac{mrsi}}\label{exp:mrsi}

\subsubsection{Baseline performance for each modality}

\subsection{Data balancing}\label{exp:balancing}

\begin{figure}
  \centering
  \includegraphics[width=0.5\linewidth]{images/aggregation.pdf}
  \caption[Balancing]{\ac{roc} \ac{auc} obtained with the different balancing strategies.}
  \label{fig:balancing}
\end{figure}

\subsection{Feature selection}\label{exp:selection}

\begin{figure}
  \hspace*{\fill}
  \subfigure[\acs{t2w} feature importance.]{
    \label{fig:feat_imp_t2w}
    \includegraphics[width=.45\textwidth]
    {images/feature_importance/feature_importance_t2w_annotated.pdf}
  }
  \hfill
  \subfigure[\acs{adc} feature importance.] {
    \label{fig:feat_imp_adc}
    \includegraphics[width=.45\textwidth]
    {images/feature_importance/feature_importance_adc_annotated.pdf}
  }
  \hspace*{\fill}\\
  \hspace*{\fill}
  \subfigure[\acs{dce} feature importance.] {
    \label{fig:feat_imp_dce}
    \includegraphics[width=.45\textwidth]
    {images/feature_importance/feature_importance_dce_annotated.pdf}
  }
  \hfill
  \subfigure[\acs{mrsi} feature importance.]{
    \label{fig:feat_imp_mrsi}
    \includegraphics[width=.45\textwidth]
    {images/feature_importance/feature_importance_mrsi_annotated.pdf}
  }
  \hspace*{\fill}
  \caption[]{Feature importances on each modality using a \ac{rf} on the
    aggregation of all features extracted.}
  \label{fig:feat_importance}
\end{figure}

\begin{table}
  \caption{Selected feature and number of occurrence for \acs*{t2w}-\acs*{mri},
    \acs*{adc} map, and one all the features are concatenated.}
  \centering
  \scriptsize
  \begin{tabular}{llll}
    \toprule
    \multicolumn{1}{c}{\textbf{\acs*{t2w}-\acs*{mri}}} & \multicolumn{1}{c}{\textbf{\acs*{adc}}} & \multicolumn{1}{c}{\textbf{\acs*{dce}-\acs*{mri}}} & \multicolumn{1}{c}{\textbf{\acs*{mrsi}}} \\
    \midrule
    113 Gabor filters & 53 Gabor filters & 14 samples  & 78 samples \\
    1 phase congruency & 2 phase congruency & & \\
    4 edges & & & \\
    1 intensity & & & \\
    \midrule
    \multicolumn{4}{c}{\textbf{267 features}} \\
    \bottomrule
  \end{tabular}
  \label{tab:selfeatocc}
\end{table}

\subsection{Combination strategies}\label{exp:classification}

\begin{figure}
  \hspace*{\fill}
  \subfigure[\ac{roc} \ac{auc} with different fusion strategies.] {
    \label{fig:combine_all}
    \includegraphics[width=.45\textwidth]
    {images/combine_all.pdf}
  }
  \hfill
  \subfigure[\ac{roc} \ac{auc} by plug-in/-out \ac{mrsi} modality.]{
    \label{fig:stacking_mrsi}
    \includegraphics[width=.45\textwidth]
    {images/stacking_wt_mrsi.pdf}
  }
  \hspace*{\fill}
  \caption[]{\ac{roc} \ac{auc} results after fusion of \ac{mri} modalities:
    \protect\subref{fig:combine_all} Comparison of different approach for
    \ac{mri} modality fusion;
    \protect\subref{fig:stacking_mrsi} Effect of adding/removing \ac{mrsi}
    using stacking strategy.}
  \label{fig:DCE-norm}
\end{figure}


% The summary of this work can be found in \ac{sec}\,\ref{sec:experiments:mpmri-comparison}
% where the results from individual modalities in
% \Ac{fig}\,\ref{fig:modality-combination:separeate_modalities} are compared to
% different strategies for combining all the modalities together in \Ac{fig}\,\ref{fig:modality-combination:combined}.
% The rest,
% \ac{sec}\,\ref{sec:experiments:mpmri-comparison}-\ref{sec:experiments:features},
% discusses particular aspects
% of the workflow in \Ac{sec}\,\ref{sec:framework} in order to bring each
% modality to its best light in order to compose
% \Ac{fig}\,\ref{fig:modality-combination:separeate_modalities}.

% \subsection{\ac{cap}-\ac{cad} bits}
% \label{sec:experiments:mpmri-comparison}
% \paragraph{The value of supplying \ac{dce} data directly}
% \paragraph{For the case of \ac{dce} data, a good normalization is all you need.}

% The features derived from the \ac{dce} modality can be categorized in:
% (i) quantitative methods which describe the signal based on parameter values
% better fitting a given pharmacokinetic model such as Toft or Brix;
% (ii) semi-quantitative methods that use some descriptor such as wash in and wash
% out to embed the signal;
% or (iii) the entire signal.

% Despite literature favoring the first two groups of
% features~\cite{lemaitre2015computer} \emph{because they integrate over the
%   singal independently}, we argue that a proper normalization of
% the entire signal that brings \emph{all the patients, all the under the same
%   coordinate system} leads to better results.
%

% \subparagraph{\ac{mrsi} features}
% Due to unavailability of some unsuppressed water acquisition, absolute quantification as presented by \citeauthor{trigui2017automatic} could not be computed~\cite{trigui2017automatic}.
% Therefore, likewise in~\cite{Parfait2012}, three different techniques are used to extract discriminative features: (i) relative quantification based on metabolite quantification, (ii) relative quantification based on bounds integration, and (iii) spectra extraction.
% \subparagraph{Anatomical features}
% Beside the aforementioned features specific at each modality, anatomical features as proposed by \citeauthor{Chen2002} and \citeauthor{Litjens2014} are computed~\cite{Chen2002,Litjens2014}.
% Therefore, 4 different metrics are computed based on the relative distance to the prostate boundary as well as the prostate center, and the relative position in the Euclidean and cylindrical coordinate systems.

% \subsection{Imbalance}
% \label{sec:experiments:imbalance}

% \Acf{fig}\,\ref{fig:imbalance} show the effect of applying under- and
% over-sampling techniques to mitigate the fact that in prostate data the amount
% of healthy voxels is much larger than the cancerous voxels.
% The under-sampling techniques reduce the number of samples of the majority class
% to be equal to the minority class.
% On the other hand, the over-sampling techniques generates new samples in the minority class, aiming at equalizing
% the number of samples in both classes.
% \ac{iht}, \ac{nm1}, \ac{nm2} and \ac{nm3} belong to under-sampling methods,
% while \ac{smote}, \ac{smoteb1} and \ac{smoteb2} are over-sampling methods.

% The results in \ac{fig}\,\ref{fig:imbalance} show that applying balancing
% methods increases the \ac{auc} score for \ac{t2w}, \ac{adc} and \ac{dce}
% modalities. Despite not rising the \ac{auc} score for the \ac{mrsi} case,
% balancing reduces the variability of the \ac{auc} score. The results also show
% that the optimal strategy varies depending on the modality and this choice has
% to be made empirically.


% \begin{figure}
%   \hspace*{\fill}
%   \subfigure[\acs{t2w}\quad(reference \ac{auc} = $0.72\pm0.122$)]{
%     \includegraphics[width=.45\textwidth]
%     {images/imbalance_effect/t2w.pdf}
%   }
%   \hfill
%   \subfigure[\acs{adc}\quad(reference \ac{auc} = $0.697\pm0.128$)] {
%     \includegraphics[width=.45\textwidth]
%     {images/imbalance_effect/adc.pdf}
%   }
%   \hspace*{\fill}\\
%   \hspace*{\fill}
%   \subfigure[\acs{dce}\quad(reference \ac{auc} = $0.679\pm0.136$)] {
%     \includegraphics[width=.45\textwidth]
%     {images/imbalance_effect/dce.pdf}
%   }
%   \hfill
%   \subfigure[\acs{mrsi}\quad(reference \ac{auc} = $0.695\pm0.159$)]{
%     \includegraphics[width=.45\textwidth]
%     {images/imbalance_effect/mrsi.pdf}
%   }
%   \hspace*{\fill}
%   \caption[] {Effect of performing data balancing at each modality. The
%     \acs{auc} reference of each modality corresponds to the same values as in \ac{fig}\,\ref{fig:modality-combination:separeate_modalities}}
%   \label{fig:imbalance}
% \end{figure}

% \subsection{Features}
% \label{sec:experiments:features}


% \section{The advantage of mpmri}%\ac{mpmri}}
% \label{sec:experiments:mpmri-comparison}

% As aforementioned, \ac{fig}\,\ref{fig:modality-combination} compares the best
% results of each individual image modality (\ac{t2w}-\ac{mri}, \ac{dce}-\ac{mri},
% \ac{adc} map and \ac{mrsi}) in
% \ac{fig}\,\ref{fig:modality-combination:separeate_modalities}) against three
% different manners of combining them in \ac{fig}\,\ref{fig:modality-combination:combined}:
% (i) in blue, a feature vector composed with the selected features of each image
% modality (those selected to produce
% \Ac{fig}\,\ref{fig:modality-combination:separeate_modalities}) is fitted to a
% \ac{rf} classifier.
% (ii) In green, the classifiers producing
% \Ac{fig}\,\ref{fig:modality-combination:separeate_modalities} are used to train
% a stacking classifier with a \ac{gb} as meta-classifier.
% And (iii) in red, all the features from all modalities (see
% \Ac{tab}\,\ref{tab:feat}) concatenated as a single vector are directly fitted to
% a \ac{rf} classifier.

% The best results are achieved using the last configuration with an \ac{auc} of
% $0.836 \pm 0.083$.
% \Acl{fig}\,\ref{fig:resultcad} illustrates qualitative results of this
% configuration by overlapping the probability map of having a \ac{cap} with the
% original \ac{t2w}-\ac{mri} slice, for 6 diverse patients.
% \emph{Something more comparing to single modality plot.}

% Due to the limited body of work using \ac{mrsi} data in \ac{cap}-\ac{cad}
% systems~\cite{lemaitre2015computer}, we also compare the stacking strategy with
% and without \ac{mrsi} data in order to see its influence. We observe that with
% no \ac{mrsi} data the final performance drops from
% $0.786 \pm 0.098$ to $0.756 \pm 0.092$.
% This aligns with the fact that $29.2\%$ of the features selected when
% concatenating all the features from all modalities are in fact from \ac{mrsi}
% data (see \Ac{tab}\,\ref{tab:selfeatocc}).


\section{Conclusion}
\label{sec:conclusion}

% this review has presented an overview and classification of the research related
% to \ac{cad} development for \ac{cap} using multi-parametric \ac{mri} data. we
% aimed at providing background information regarding multi-parametric \ac{mri}
% imaging techniques and a description of the work-flow in the different \ac{cad}
% stages. the methods used in the literature for each of these stages have been
% reviewed along with the available results of the \ac{cad} systems. moreover,
% insight discussions and possible future research directions have also been
% given. finally, a multi-parametric multi-vendor dataset has been made available
% to the research community in order to provide a standardised platform for
% \ac{cad} development and evaluation for \ac{cap} using multi-parametric
% \ac{mri}.

% In this regard, \ac{mpmri} is frequently
% used to build robust \ac{cad} systems to detect, localize, and grade \ac{cap}.
% In general, \ac{cad} systems are based on \ac{mpmri} which potentially combines
% several of the following modalities~\citep{lemaitre2015computer}:
% \ac{t2w}-\ac{mri}, \ac{dce}-\ac{mri}, \ac{adc} maps, and \ac{mrsi}.



\begin{figure}
  \hspace*{\fill}
  \subfigure[\acs*{auc} = 0.922]{\label{fig:pat634}\includegraphics[height=.15\textheight]{images/qualitative_results/patient_634_roi.pdf}}
  \hfill
  \subfigure[\acs*{auc} = 0.914]{\label{fig:pat1036}\includegraphics[height=.15\textheight]{images/qualitative_results/patient_1036_roi.pdf}}
  \hspace*{\fill}\\
  \hspace*{\fill}
  \subfigure[\acs*{auc} = 0.692]{\label{fig:pat634}\includegraphics[height=.15\textheight]{images/qualitative_results/patient_410_roi.pdf}}
  \hfill
  \subfigure[\acs*{auc} = 0.735]{\label{fig:pat1036}\includegraphics[height=.15\textheight]{images/qualitative_results/patient_1041_roi.pdf}}
  \hspace*{\fill}
  \caption[Illustration the resulting detection of our \acs*{mpmri} \acs*{cad} for \acs*{cap} detection.]{Illustration the resulting detection of our \acs*{mpmri} \acs*{cad} for \acs*{cap} detection. The blue contours corresponds to the \ac{cap} while the \texttt{jet} overlay represents the probability.}
  \label{fig:resultcad}
\end{figure}

% \input{./content/chapter6.tex}


Therefore, including \ac{mrsi} into the classification pipeline increases the \ac{auc} from $0.756 \pm 0.092$ to $0.786 \pm 0.098$ for a gain of $0.030$.

%%%%%%%%%%%%%%%%%%%% End comment



% \begin{table[bt]
% \caption{This is a table. Tables should be self-contained and complement, but not duplicate, information contained in the text. They should be not be provided as images. Legends should be concise but comprehensive â€“ the table, legend and footnotes must be understandable without reference to the text. All abbreviations must be defined in footnotes.}
% \begin{threeparttable}
% \begin{tabular}{lccrr}
% \headrow
% \thead{Variables} & \thead{JKL ($\boldsymbol{n=30}$)} & \thead{Control ($\boldsymbol{n=40}$)} & \thead{MN} & \thead{$\boldsymbol t$ (68)}\\
% Age at testing & 38 & 58 & 504.48 & 58 ms\\
% Age at testing & 38 & 58 & 504.48 & 58 ms\\
% Age at testing & 38 & 58 & 504.48 & 58 ms\\
% Age at testing & 38 & 58 & 504.48 & 58 ms\\
% \hiderowcolors
% stop alternating row colors from here onwards\\
% Age at testing & 38 & 58 & 504.48 & 58 ms\\
% Age at testing & 38 & 58 & 504.48 & 58 ms\\
% \hline  % Please only put a hline at the end of the table
% \end{tabular}

% \begin{tablenotes}
% \item JKL, just keep laughing; MN, merry noise.
% \end{tablenotes}
% \end{threeparttable}
% \end{table}

% \section*{acknowledgements}
% Acknowledgements should include contributions from anyone who does not meet the criteria for authorship (for example, to recognize contributions from people who provided technical help, collation of data, writing assistance, acquisition of funding, or a department chairperson who provided general support), as well as any funding or other support information.

% \section*{conflict of interest}
% The authors report no potential conflicts of interest.

% \printendnotes

% Submissions are not required to reflect the precise reference formatting of the journal (use of italics, bold etc.), however it is important that all key elements of each reference are included.
% \bibliography{sample}
\bibliography{literature_review_2}

\begin{biography}[example-image-1x1]{A.~One}
Please check with the journal's author guidelines whether author biographies are required. They are usually only included for review-type articles, and typically require photos and brief biographies (up to 75 words) for each author.
\bigskip
\bigskip
\end{biography}

\graphicalabstract{example-image-1x1}{Please check the journal's author guildines for whether a graphical abstract, key points, new findings, or other items are required for display in the Table of Contents.}

\end{document}

%  LocalWords:  voxels
